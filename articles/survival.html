<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Survival Analysis in mlr3proba • mlr3proba</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<link href="../extra.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Survival Analysis in mlr3proba">
<meta property="og:description" content="">
<meta property="og:image" content="https://mlr3proba.mlr-org.com/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://mlr-org.com"><img src="https://raw.githubusercontent.com/mlr-org/mlr3/master/man/figures/logo.png" id="hexlogo" alt="mlr-org"></a>
        <a class="navbar-brand" href="../index.html">mlr3proba <small>v0.1.4</small></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/survival.html">Survival Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://mlr3book.mlr-org.com">
    <span class="fa fa fa fa-link"></span>
     
    mlr3book
  </a>
</li>
        <li>
  <a href="https://github.com/mlr-org/mlr3proba">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/">
    <span class="fa fa fa fa-comments"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/questions/tagged/mlr3">
    <span class="fab fa fab fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Survival Analysis in mlr3proba</h1>
                        <h4 class="author">Raphael Sonabend</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/mlr3proba/blob/master/vignettes/survival.Rmd"><code>vignettes/survival.Rmd</code></a></small>
      <div class="hidden name"><code>survival.Rmd</code></div>

    </div>

    
    
<p>This vignette is an introduction to performing survival analysis in <strong>mlr3proba</strong>.</p>
<div id="a-very-quick-introduction-to-survival-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#a-very-quick-introduction-to-survival-analysis" class="anchor"></a>A very quick introduction to survival analysis</h2>
<p>Survival analysis is a sub-field of supervised machine learning in which the aim is to predict the survival distribution of a given individual. Arguably the main feature of survival analysis is that unlike classification and regression, learners are trained on two features: 1. the time until the event takes place, 2. the event type: either censoring or death. At a particular time-point, an individual is either: alive, dead, or censored. Censoring occurs if it is unknown if an individual is alive or dead. For example, say we are interested in patients in hospital and every day it is recorded if they are alive or dead, then after a patient leaves it is unknown if they are alive or dead, hence they are censored.</p>
<p>In the case that there is no censoring, but a predicted probability distribution is still the goal, then probabilistic regression learners are advised instead.</p>
</div>
<div id="survival-tasks" class="section level2">
<h2 class="hasAnchor">
<a href="#survival-tasks" class="anchor"></a>Survival Tasks</h2>
<p>Unlike <code>TaskClassif</code> and <code>TaskRegr</code> which have a single ‘target’ argument, <code>TaskSurv</code> mimics the <code><a href="https://rdrr.io/pkg/survival/man/Surv.html">survival::Surv</a></code> object and has three-four target arguments (dependent on censoring type)</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mlr3proba); <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mlr3); <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(survival)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># type = "right" is default</span></span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a>TaskSurv<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"right_censored"</span>, <span class="dt">backend =</span> survival<span class="op">::</span>rats,</span>
<span id="cb1-6"><a href="#cb1-6"></a>             <span class="dt">time =</span> <span class="st">"time"</span>, <span class="dt">event =</span> <span class="st">"status"</span>, <span class="dt">type =</span> <span class="st">"right"</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt; &lt;TaskSurv:right_censored&gt; (300 x 5)</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt; * Target: time, status</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt; * Properties: -</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt; * Features (3):</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt;   - int (1): litter</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt;   - dbl (1): rx</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&gt;   - chr (1): sex</span></span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a>task =<span class="st"> </span>TaskSurv<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"interval_censored"</span>, <span class="dt">backend =</span> survival<span class="op">::</span>bladder2[,<span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">7</span>)],</span>
<span id="cb1-16"><a href="#cb1-16"></a>                    <span class="dt">time =</span> <span class="st">"start"</span>, <span class="dt">time2 =</span> <span class="st">"stop"</span>, <span class="dt">type =</span> <span class="st">"interval2"</span>)</span>
<span id="cb1-17"><a href="#cb1-17"></a>task</span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co">#&gt; &lt;TaskSurv:interval_censored&gt; (178 x 6)</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co">#&gt; * Target: start, stop</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="co">#&gt; * Properties: -</span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="co">#&gt; * Features (4):</span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="co">#&gt;   - dbl (2): enum, rx</span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="co">#&gt;   - int (2): number, size</span></span>
<span id="cb1-24"><a href="#cb1-24"></a>task<span class="op">$</span><span class="kw">truth</span>()[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="co">#&gt;  [1] [0,  1] [0,  4] [0,  7] [0, 10] [0,  6] [6, 10] [0, 14] [0, 18] [0,  5]</span></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="co">#&gt; [10] [5, 18]</span></span></code></pre></div>
</div>
<div id="train-and-predict" class="section level2">
<h2 class="hasAnchor">
<a href="#train-and-predict" class="anchor"></a>Train and Predict</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co"># create task and learner</span></span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a>veteran =<span class="st"> </span>mlr3misc<span class="op">::</span><span class="kw"><a href="https://mlr3misc.mlr-org.com/reference/load_dataset.html">load_dataset</a></span>(<span class="st">"veteran"</span>, <span class="dt">package =</span> <span class="st">"survival"</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a>task_veteran =<span class="st"> </span>TaskSurv<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"veteran"</span>, <span class="dt">backend =</span> veteran, <span class="dt">time =</span> <span class="st">"time"</span>, <span class="dt">event =</span> <span class="st">"status"</span>)</span>
<span id="cb2-6"><a href="#cb2-6"></a>learner =<span class="st"> </span><span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span>(<span class="st">"surv.coxph"</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co"># train/test split </span></span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a>train_set =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(task_veteran<span class="op">$</span>nrow, <span class="fl">0.8</span> <span class="op">*</span><span class="st"> </span>task_veteran<span class="op">$</span>nrow)</span>
<span id="cb2-11"><a href="#cb2-11"></a>test_set =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(task_veteran<span class="op">$</span>nrow), train_set)</span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co"># fit Cox PH and inspect model</span></span>
<span id="cb2-14"><a href="#cb2-14"></a></span>
<span id="cb2-15"><a href="#cb2-15"></a>learner<span class="op">$</span><span class="kw">train</span>(task_veteran, <span class="dt">row_ids =</span> train_set)</span>
<span id="cb2-16"><a href="#cb2-16"></a>learner<span class="op">$</span>model</span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">#&gt; Call:</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">#&gt; survival::coxph(formula = task$formula(), data = task$data(), </span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">#&gt;     x = TRUE)</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">#&gt; </span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co">#&gt;                        coef exp(coef)  se(coef)      z        p</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="co">#&gt; age               -0.007685  0.992345  0.011751 -0.654 0.513130</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="co">#&gt; celltypesmallcell  0.976473  2.655076  0.317421  3.076 0.002096</span></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="co">#&gt; celltypeadeno      1.173923  3.234657  0.354138  3.315 0.000917</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="co">#&gt; celltypelarge      0.460501  1.584868  0.334837  1.375 0.169039</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="co">#&gt; diagtime           0.001186  1.001187  0.009848  0.120 0.904155</span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="co">#&gt; karno             -0.029826  0.970614  0.006497 -4.590 4.42e-06</span></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="co">#&gt; prior              0.010400  1.010454  0.026531  0.392 0.695071</span></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="co">#&gt; trt                0.225305  1.252705  0.247522  0.910 0.362695</span></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="co">#&gt; </span></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="co">#&gt; Likelihood ratio test=47.36  on 8 df, p=1.307e-07</span></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="co">#&gt; n= 109, number of events= 100</span></span>
<span id="cb2-33"><a href="#cb2-33"></a></span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="co"># make predictions for new data</span></span>
<span id="cb2-35"><a href="#cb2-35"></a></span>
<span id="cb2-36"><a href="#cb2-36"></a>prediction =<span class="st"> </span>learner<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(task_veteran, <span class="dt">row_ids =</span> test_set)</span>
<span id="cb2-37"><a href="#cb2-37"></a>prediction</span>
<span id="cb2-38"><a href="#cb2-38"></a><span class="co">#&gt; &lt;PredictionSurv&gt; for 28 observations:</span></span>
<span id="cb2-39"><a href="#cb2-39"></a><span class="co">#&gt;     row_id time status      crank                distr         lp</span></span>
<span id="cb2-40"><a href="#cb2-40"></a><span class="co">#&gt;          3  228   TRUE -0.6936862 &lt;VectorDistribution&gt; -0.6936862</span></span>
<span id="cb2-41"><a href="#cb2-41"></a><span class="co">#&gt;          4  126   TRUE -0.7746938 &lt;VectorDistribution&gt; -0.7746938</span></span>
<span id="cb2-42"><a href="#cb2-42"></a><span class="co">#&gt;          8  110   TRUE -1.4899216 &lt;VectorDistribution&gt; -1.4899216</span></span>
<span id="cb2-43"><a href="#cb2-43"></a><span class="co">#&gt; ---                                                              </span></span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="co">#&gt;        119    7   TRUE  1.1495552 &lt;VectorDistribution&gt;  1.1495552</span></span>
<span id="cb2-45"><a href="#cb2-45"></a><span class="co">#&gt;        128   19   TRUE  0.9844033 &lt;VectorDistribution&gt;  0.9844033</span></span>
<span id="cb2-46"><a href="#cb2-46"></a><span class="co">#&gt;        137   49   TRUE  0.8945899 &lt;VectorDistribution&gt;  0.8945899</span></span></code></pre></div>
</div>
<div id="evaluate---crank-lp-and-distr" class="section level2">
<h2 class="hasAnchor">
<a href="#evaluate---crank-lp-and-distr" class="anchor"></a>Evaluate - crank, lp, and distr</h2>
<p>Every <code>PredictionSurv</code> object can predict one or more of:</p>
<ul>
<li>
<code>lp</code> - Linear predictor calculated as the fitted coefficients multiplied by the test data.</li>
<li>
<code>distr</code> - Predicted survival distribution, either discrete or continuous. Implemented in <strong><a href="https://CRAN.R-project.org/package=distr6">distr6</a></strong>.</li>
<li>
<code>crank</code> - Continuous risk ranking.</li>
</ul>
<p><code>lp</code> and <code>crank</code> can be used with measures of discrimination such as the concordance index. Whilst <code>lp</code> is a specific mathematical prediction, <code>crank</code> is any continuous ranking that identifies who is more or less likely to experience the event. So far the only implemented learner that only returns a continuous ranking is <code>surv.svm</code>. If a <code>PredictionSurv</code> returns an <code>lp</code> then the <code>crank</code> is identical to this. Otherwise <code>crank</code> is calculated as the expectation of the predicted survival distribution. Note that for linear proportional hazards models, the ranking (but not necessarily the <code>crank</code> score itself) given by <code>lp</code> and the expectation of <code>distr</code>, is identical.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># In the previous example, Cox model predicts `lp` so `crank` is identical</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw"><a href="https://rdrr.io/r/base/all.html">all</a></span>(prediction<span class="op">$</span>lp <span class="op">==</span><span class="st"> </span>prediction<span class="op">$</span>crank)</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>prediction<span class="op">$</span>lp[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt;  [1] -0.69368619 -0.77469379 -1.48992162 -1.02294630  0.10603704  0.35349280</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt;  [7]  0.19769846 -0.24070498  1.61950353  0.02121054</span></span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co"># These are evaluated with measures of discrimination and calibration.</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co"># As all PredictionSurv objects will return crank, Harrell's C is the default measure.</span></span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a>prediction<span class="op">$</span><span class="kw">score</span>()</span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt; surv.harrellC </span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt;     0.7526596</span></span>
<span id="cb3-15"><a href="#cb3-15"></a></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co"># distr is evaluated with probabilistic scoring rules.</span></span>
<span id="cb3-17"><a href="#cb3-17"></a></span>
<span id="cb3-18"><a href="#cb3-18"></a>measure =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"surv.graf"</span>, <span class="st">"surv.grafSE"</span>), msr)</span>
<span id="cb3-19"><a href="#cb3-19"></a>prediction<span class="op">$</span><span class="kw">score</span>(measure)</span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co">#&gt;   surv.graf surv.grafSE </span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="co">#&gt;   0.1120402   0.0129813</span></span>
<span id="cb3-22"><a href="#cb3-22"></a></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co"># Often measures can be integrated over mutliple time-points, or return</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co"># predictions for single time-points</span></span>
<span id="cb3-25"><a href="#cb3-25"></a></span>
<span id="cb3-26"><a href="#cb3-26"></a>measure =<span class="st"> </span><span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span>(<span class="st">"surv.graf"</span>, <span class="dt">times =</span> <span class="dv">60</span>)</span>
<span id="cb3-27"><a href="#cb3-27"></a>prediction<span class="op">$</span><span class="kw">score</span>(measure)</span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="co">#&gt; surv.graf </span></span>
<span id="cb3-29"><a href="#cb3-29"></a><span class="co">#&gt; 0.1457346</span></span></code></pre></div>
<div id="probability-distributions-with-distr6" class="section level3">
<h3 class="hasAnchor">
<a href="#probability-distributions-with-distr6" class="anchor"></a>Probability distributions with distr6</h3>
<p>Predicted distributions are implemented in <strong><a href="https://CRAN.R-project.org/package=distr6">distr6</a></strong>, which contains functionality for plotting and further analysis of probability distributions. See <a href="https://alan-turing-institute.github.io/distr6/">here</a> for full tutorials. Briefly we will go over the most important parts for <strong>mlr3proba</strong>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>task =<span class="st"> </span><span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tgen</a></span>(<span class="st">"simsurv"</span>)<span class="op">$</span><span class="kw">generate</span>(<span class="dv">20</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a>learner =<span class="st"> </span><span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span>(<span class="st">"surv.coxph"</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># In general it is not advised to train/predict on same data</span></span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a>prediction =<span class="st"> </span>learner<span class="op">$</span><span class="kw">train</span>(task)<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(task)</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co"># The predicted `distr` is a VectorDistribution consisting of 20 separate distributions</span></span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a>prediction<span class="op">$</span>distr</span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt; WeightDisc1 WeightDisc2 ... WeightDisc19 WeightDisc20</span></span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co"># These can be extracted and queried either invidually...</span></span>
<span id="cb4-14"><a href="#cb4-14"></a></span>
<span id="cb4-15"><a href="#cb4-15"></a>prediction<span class="op">$</span>distr[<span class="dv">1</span>]<span class="op">$</span><span class="kw">survival</span>(<span class="dv">60</span><span class="op">:</span><span class="dv">70</span>)</span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt;  [1] 0 0 0 0 0 0 0 0 0 0 0</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>prediction<span class="op">$</span>distr[<span class="dv">1</span>]<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>()</span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt; [1] 1.694734</span></span>
<span id="cb4-19"><a href="#cb4-19"></a></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="co"># ...or together</span></span>
<span id="cb4-21"><a href="#cb4-21"></a></span>
<span id="cb4-22"><a href="#cb4-22"></a>prediction<span class="op">$</span>distr<span class="op">$</span><span class="kw">cdf</span>(<span class="dv">60</span>)[,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span>
<span id="cb4-23"><a href="#cb4-23"></a><span class="co">#&gt;    WeightDisc1 WeightDisc2 WeightDisc3 WeightDisc4 WeightDisc5 WeightDisc6</span></span>
<span id="cb4-24"><a href="#cb4-24"></a><span class="co">#&gt; 1:           1           1           1           1           1           1</span></span>
<span id="cb4-25"><a href="#cb4-25"></a><span class="co">#&gt;    WeightDisc7 WeightDisc8 WeightDisc9 WeightDisc10</span></span>
<span id="cb4-26"><a href="#cb4-26"></a><span class="co">#&gt; 1:           1           1           1            1</span></span>
<span id="cb4-27"><a href="#cb4-27"></a>prediction<span class="op">$</span>distr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>()[,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span>
<span id="cb4-28"><a href="#cb4-28"></a><span class="co">#&gt;    WeightDisc1 WeightDisc2 WeightDisc3 WeightDisc4 WeightDisc5 WeightDisc6</span></span>
<span id="cb4-29"><a href="#cb4-29"></a><span class="co">#&gt; 1:    1.694734    1.259515    1.490812    1.630679    1.756059    1.724937</span></span>
<span id="cb4-30"><a href="#cb4-30"></a><span class="co">#&gt;    WeightDisc7 WeightDisc8 WeightDisc9 WeightDisc10</span></span>
<span id="cb4-31"><a href="#cb4-31"></a><span class="co">#&gt; 1:    1.680944    1.753342    1.662975     1.696142</span></span>
<span id="cb4-32"><a href="#cb4-32"></a></span>
<span id="cb4-33"><a href="#cb4-33"></a><span class="co"># As well as plotted</span></span>
<span id="cb4-34"><a href="#cb4-34"></a></span>
<span id="cb4-35"><a href="#cb4-35"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(prediction<span class="op">$</span>distr[<span class="dv">1</span>], <span class="st">"survival"</span>, <span class="dt">main =</span> <span class="st">"First 2 Survival Curves"</span>)</span>
<span id="cb4-36"><a href="#cb4-36"></a><span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(prediction<span class="op">$</span>distr[<span class="dv">2</span>], <span class="st">"survival"</span>, <span class="dt">col =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="survival_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
</div>
<div id="composition" class="section level2">
<h2 class="hasAnchor">
<a href="#composition" class="anchor"></a>Composition</h2>
<p>Finally we take a look at the <code>PipeOp</code>s implemented in <strong>mlr3proba</strong>, which are used for composition of predict types. For example, if a learner only returns a linear predictor, then <code>PipeOpDistrCompositor</code> can be used to estimate a survival distribution. Or, if a learner returns a <code>distr</code> then <code>PipeOpCrankCompositor</code> can be used to estimate <code>crank</code> from <code>distr</code>. See <strong><a href="https://github.com/mlr-org/mlr3pipelines">mlr3pipelines</a></strong> for full tutorials and details on <code>PipeOp</code>s.</p>
<div id="pipeopdistrcompositor" class="section level3">
<h3 class="hasAnchor">
<a href="#pipeopdistrcompositor" class="anchor"></a>PipeOpDistrCompositor</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mlr3pipelines)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co"># PipeOpDistrCompositor - Train one model with a baseline distribution,</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># (Kaplan-Meier or Nelson-Aalen), and another with a predicted linear predictor.</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>task =<span class="st"> </span><span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tgen</a></span>(<span class="st">"simsurv"</span>)<span class="op">$</span><span class="kw">generate</span>(<span class="dv">30</span>)</span>
<span id="cb5-6"><a href="#cb5-6"></a>leaner_lp =<span class="st"> </span><span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span>(<span class="st">"surv.gbm"</span>, <span class="dt">bag.fraction =</span> <span class="dv">1</span>, <span class="dt">n.trees =</span> 50L)</span>
<span id="cb5-7"><a href="#cb5-7"></a>leaner_distr =<span class="st"> </span><span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span>(<span class="st">"surv.kaplan"</span>)</span>
<span id="cb5-8"><a href="#cb5-8"></a>prediction_lp =<span class="st"> </span>leaner_lp<span class="op">$</span><span class="kw">train</span>(task)<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(task)</span>
<span id="cb5-9"><a href="#cb5-9"></a>prediction_distr =<span class="st"> </span>leaner_distr<span class="op">$</span><span class="kw">train</span>(task)<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(task)</span>
<span id="cb5-10"><a href="#cb5-10"></a>prediction_lp<span class="op">$</span>distr</span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-12"><a href="#cb5-12"></a></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co"># Doesn't need training. Base = baseline distribution. ph = Proportional hazards.</span></span>
<span id="cb5-14"><a href="#cb5-14"></a></span>
<span id="cb5-15"><a href="#cb5-15"></a>pod =<span class="st"> </span><span class="kw"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span>(<span class="st">"distrcompose"</span>, <span class="dt">param_vals =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">form =</span> <span class="st">"ph"</span>, <span class="dt">overwrite =</span> <span class="ot">FALSE</span>))</span>
<span id="cb5-16"><a href="#cb5-16"></a>prediction =<span class="st"> </span>pod<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">base =</span> prediction_distr, <span class="dt">pred =</span> prediction_lp))<span class="op">$</span>output</span>
<span id="cb5-17"><a href="#cb5-17"></a></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="co"># Now we have a predicted distr!</span></span>
<span id="cb5-19"><a href="#cb5-19"></a></span>
<span id="cb5-20"><a href="#cb5-20"></a>prediction<span class="op">$</span>distr</span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="co">#&gt; WeightDisc1 WeightDisc2 ... WeightDisc29 WeightDisc30</span></span>
<span id="cb5-22"><a href="#cb5-22"></a></span>
<span id="cb5-23"><a href="#cb5-23"></a><span class="co"># This can all be simplified by using the distrcompose wrapper</span></span>
<span id="cb5-24"><a href="#cb5-24"></a></span>
<span id="cb5-25"><a href="#cb5-25"></a>gbm.distr =<span class="st"> </span><span class="kw"><a href="../reference/distrcompositor.html">distrcompositor</a></span>(<span class="dt">learner =</span> <span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span>(<span class="st">"surv.gbm"</span>, <span class="dt">bag.fraction =</span> <span class="dv">1</span>, <span class="dt">n.trees =</span> 50L),</span>
<span id="cb5-26"><a href="#cb5-26"></a>                             <span class="dt">estimator =</span> <span class="st">"kaplan"</span>,</span>
<span id="cb5-27"><a href="#cb5-27"></a>                             <span class="dt">form =</span> <span class="st">"aft"</span>,</span>
<span id="cb5-28"><a href="#cb5-28"></a>                             <span class="dt">overwrite =</span> <span class="ot">FALSE</span>)</span>
<span id="cb5-29"><a href="#cb5-29"></a>gbm.distr<span class="op">$</span><span class="kw">train</span>(task)<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(task)</span>
<span id="cb5-30"><a href="#cb5-30"></a><span class="co">#&gt; &lt;PredictionSurv&gt; for 30 observations:</span></span>
<span id="cb5-31"><a href="#cb5-31"></a><span class="co">#&gt;     row_id     time status       crank                distr          lp</span></span>
<span id="cb5-32"><a href="#cb5-32"></a><span class="co">#&gt;          1 5.000000  FALSE -0.19367047 &lt;VectorDistribution&gt; -0.19367047</span></span>
<span id="cb5-33"><a href="#cb5-33"></a><span class="co">#&gt;          2 3.568860   TRUE -0.66748168 &lt;VectorDistribution&gt; -0.66748168</span></span>
<span id="cb5-34"><a href="#cb5-34"></a><span class="co">#&gt;          3 1.128017   TRUE -0.05205574 &lt;VectorDistribution&gt; -0.05205574</span></span>
<span id="cb5-35"><a href="#cb5-35"></a><span class="co">#&gt; ---                                                                    </span></span>
<span id="cb5-36"><a href="#cb5-36"></a><span class="co">#&gt;         28 1.635774   TRUE -0.17106619 &lt;VectorDistribution&gt; -0.17106619</span></span>
<span id="cb5-37"><a href="#cb5-37"></a><span class="co">#&gt;         29 5.000000  FALSE -0.47381121 &lt;VectorDistribution&gt; -0.47381121</span></span>
<span id="cb5-38"><a href="#cb5-38"></a><span class="co">#&gt;         30 3.155294   TRUE -0.66748168 &lt;VectorDistribution&gt; -0.66748168</span></span></code></pre></div>
</div>
<div id="pipeopcrankcompositor" class="section level3">
<h3 class="hasAnchor">
<a href="#pipeopcrankcompositor" class="anchor"></a>PipeOpCrankCompositor</h3>
<p>Note that a <code>PredictionSurv</code> will always return <code>crank</code>, but this may either be the same as the <code>lp</code> or the expectation of <code>distr</code>. This compositor allows you to change the estimation method.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># PipeOpCrankCompositor - Only one model required.</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>leaner =<span class="st"> </span><span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span>(<span class="st">"surv.coxph"</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a>prediction =<span class="st"> </span>leaner<span class="op">$</span><span class="kw">train</span>(task)<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(task)</span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co"># Doesn't need training - Note: no `overwrite` option as `crank` is always</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co"># present so the compositor if used will always overwrite.</span></span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a>poc =<span class="st"> </span><span class="kw"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span>(<span class="st">"crankcompose"</span>, <span class="dt">param_vals =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">method =</span> <span class="st">"mean"</span>))</span>
<span id="cb6-9"><a href="#cb6-9"></a>composed_prediction =<span class="st"> </span>poc<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(prediction))<span class="op">$</span>output</span>
<span id="cb6-10"><a href="#cb6-10"></a></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co"># Note that whilst the actual values of `lp` and `crank` are different,</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co"># the rankings are the same, so discrimination measures are unchanged.</span></span>
<span id="cb6-13"><a href="#cb6-13"></a></span>
<span id="cb6-14"><a href="#cb6-14"></a>prediction<span class="op">$</span>crank[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt;  [1]  0.19248733 -0.43871848  0.39422978  0.24340349 -0.20020759  0.15094767</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt;  [7]  0.60484819 -0.56638731  0.01629422  0.42356422</span></span>
<span id="cb6-17"><a href="#cb6-17"></a>composed_prediction<span class="op">$</span>crank[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">#&gt;  [1] 1.6122990 1.0944552 1.7651577 1.6525095 1.2873051 1.5788921 1.8987710</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">#&gt;  [8] 0.9969524 1.4680414 1.7856538</span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="kw"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(prediction<span class="op">$</span>crank) <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(composed_prediction<span class="op">$</span>crank))</span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="dt">Original =</span> prediction<span class="op">$</span><span class="kw">score</span>(), <span class="dt">Composed =</span> composed_prediction<span class="op">$</span><span class="kw">score</span>())</span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="co">#&gt;                Original  Composed</span></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="co">#&gt; surv.harrellC 0.5854342 0.5854342</span></span>
<span id="cb6-25"><a href="#cb6-25"></a></span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="co"># Again a wrapper can be used to simplify this</span></span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="kw"><a href="../reference/crankcompositor.html">crankcompositor</a></span>(<span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span>(<span class="st">"surv.coxph"</span>), <span class="dt">method =</span> <span class="st">"mean"</span>)<span class="op">$</span><span class="kw">train</span>(task)<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(task)</span>
<span id="cb6-28"><a href="#cb6-28"></a><span class="co">#&gt; &lt;PredictionSurv&gt; for 30 observations:</span></span>
<span id="cb6-29"><a href="#cb6-29"></a><span class="co">#&gt;     row_id     time status    crank                distr          lp</span></span>
<span id="cb6-30"><a href="#cb6-30"></a><span class="co">#&gt;          1 5.000000  FALSE 1.612299 &lt;VectorDistribution&gt;  0.19248733</span></span>
<span id="cb6-31"><a href="#cb6-31"></a><span class="co">#&gt;          2 3.568860   TRUE 1.094455 &lt;VectorDistribution&gt; -0.43871848</span></span>
<span id="cb6-32"><a href="#cb6-32"></a><span class="co">#&gt;          3 1.128017   TRUE 1.765158 &lt;VectorDistribution&gt;  0.39422978</span></span>
<span id="cb6-33"><a href="#cb6-33"></a><span class="co">#&gt; ---                                                                 </span></span>
<span id="cb6-34"><a href="#cb6-34"></a><span class="co">#&gt;         28 1.635774   TRUE 1.232586 &lt;VectorDistribution&gt; -0.26655353</span></span>
<span id="cb6-35"><a href="#cb6-35"></a><span class="co">#&gt;         29 5.000000  FALSE 1.436710 &lt;VectorDistribution&gt; -0.02125514</span></span>
<span id="cb6-36"><a href="#cb6-36"></a><span class="co">#&gt;         30 3.155294   TRUE 1.073284 &lt;VectorDistribution&gt; -0.46592203</span></span></code></pre></div>
</div>
</div>
<div id="all-together-now" class="section level2">
<h2 class="hasAnchor">
<a href="#all-together-now" class="anchor"></a>All Together Now</h2>
<p>Putting all of this together we can perform a (overly simplified) benchmark experiment to find the best learner for making predictions on a simulated dataset.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mlr3pipelines); <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mlr3); <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mlr3tuning); <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(paradox)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">42</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a>task =<span class="st"> </span><span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tgen</a></span>(<span class="st">"simsurv"</span>)<span class="op">$</span><span class="kw">generate</span>(<span class="dv">50</span>)</span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a>composed_lrn_gbm =<span class="st"> </span><span class="kw"><a href="../reference/distrcompositor.html">distrcompositor</a></span>(<span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span>(<span class="st">"surv.gbm"</span>, <span class="dt">bag.fraction =</span> <span class="dv">1</span>, <span class="dt">n.trees =</span> 50L),</span>
<span id="cb7-7"><a href="#cb7-7"></a>                                   <span class="st">"kaplan"</span>, <span class="st">"ph"</span>)</span>
<span id="cb7-8"><a href="#cb7-8"></a></span>
<span id="cb7-9"><a href="#cb7-9"></a>lrns =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"surv."</span>, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"kaplan"</span>, <span class="st">"coxph"</span>, <span class="st">"parametric"</span>)), lrn)</span>
<span id="cb7-10"><a href="#cb7-10"></a>lrns[[<span class="dv">3</span>]]<span class="op">$</span>param_set<span class="op">$</span>values =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">dist =</span> <span class="st">"weibull"</span>, <span class="dt">type =</span> <span class="st">"ph"</span>)</span>
<span id="cb7-11"><a href="#cb7-11"></a></span>
<span id="cb7-12"><a href="#cb7-12"></a>design =<span class="st"> </span><span class="kw"><a href="https://mlr3.mlr-org.com/reference/benchmark_grid.html">benchmark_grid</a></span>(<span class="dt">tasks =</span> task, <span class="dt">learners =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(lrns, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(composed_lrn_gbm)),</span>
<span id="cb7-13"><a href="#cb7-13"></a>                        <span class="dt">resamplings =</span> <span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span>(<span class="st">"cv"</span>, <span class="dt">folds =</span> <span class="dv">2</span>))</span>
<span id="cb7-14"><a href="#cb7-14"></a></span>
<span id="cb7-15"><a href="#cb7-15"></a>bm =<span class="st"> </span><span class="kw"><a href="https://mlr3.mlr-org.com/reference/benchmark.html">benchmark</a></span>(design)</span>
<span id="cb7-16"><a href="#cb7-16"></a>bm<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"surv.harrellC"</span>,<span class="st">"surv.graf"</span>,<span class="st">"surv.grafSE"</span>), msr))[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">4</span>, <span class="dv">7</span><span class="op">:</span><span class="dv">9</span>)]</span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">#&gt;                           learner_id surv.harrellC surv.graf surv.grafSE</span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co">#&gt; 1:                       surv.kaplan     0.5000000 0.2107141  0.02003976</span></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="co">#&gt; 2:                        surv.coxph     0.5003190 0.2259178  0.03210873</span></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="co">#&gt; 3:                   surv.parametric     0.5066986 0.4481043  0.06730402</span></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="co">#&gt; 4: surv.kaplan.surv.gbm.distrcompose     0.4811204 0.2774313  0.04296744</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#a-very-quick-introduction-to-survival-analysis">A very quick introduction to survival analysis</a></li>
      <li><a href="#survival-tasks">Survival Tasks</a></li>
      <li><a href="#train-and-predict">Train and Predict</a></li>
      <li>
<a href="#evaluate---crank-lp-and-distr">Evaluate - crank, lp, and distr</a><ul class="nav nav-pills nav-stacked">
<li><a href="#probability-distributions-with-distr6">Probability distributions with distr6</a></li>
      </ul>
</li>
      <li>
<a href="#composition">Composition</a><ul class="nav nav-pills nav-stacked">
<li><a href="#pipeopdistrcompositor">PipeOpDistrCompositor</a></li>
      <li><a href="#pipeopcrankcompositor">PipeOpCrankCompositor</a></li>
      </ul>
</li>
      <li><a href="#all-together-now">All Together Now</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Raphael Sonabend, Franz Kiraly, Michel Lang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
